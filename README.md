Don't look at this awful code.
